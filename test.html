!DOCTYPE html
html lang=zh-TW
head
  meta charset=UTF-8
  meta name=viewport content=width=device-width, initial-scale=1.0
  
  titleArtale æ‰å¯¶çµ±è¨ˆç«™ - æ¸¬è©¦ç‰ˆtitle
  meta name=description content=Artale æ¥“ä¹‹è°·æ‰å¯¶çµ±è¨ˆç«™ã€‚å…¨ç¶²å”¯ä¸€çš„çœŸå¯¦æ•¸æ“šå¹³å°ï¼Œæä¾›æ€ªç‰©æ‰å¯¶ç‡æŸ¥è©¢ã€BOSS æˆ°åˆ©å“çµ±è¨ˆã€å€‹äººé‹æ°£åˆ†æï¼ŒåŠ©æ‚¨æŒæ¡æ‰“å¯¶æ•ˆç‡ã€‚
  
  script async src=httpspagead2.googlesyndication.compageadjsadsbygoogle.jsclient=ca-pub-4011206268996883
     crossorigin=anonymousscript

  style
    root {
      --bg-color #f8fafc;
      --card-bg #ffffff;
      --text-main #0f172a;
      --text-sub #475569;
      --accent #f97316;
      --accent-hover #ea580c;
      --border #e2e8f0;
      --input-bg #ffffff;
      --input-focus #ffedd5;
      --shadow 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    body.night-mode {
      --bg-color #0f172a;
      --card-bg #1e293b;
      --text-main #f1f5f9;
      --text-sub #94a3b8;
      --accent #fb923c;
      --accent-hover #fdba74;
      --border #334155;
      --input-bg #0f172a;
      --input-focus #262626;
    }

    body {
      margin 0;
      background-color var(--bg-color);
      color var(--text-main);
      font-family PingFang TC, Noto Sans TC, Microsoft JhengHei, system-ui, sans-serif;
      font-size 18px;
      line-height 1.6;
      transition all 0.3s ease;
      display flex;
      flex-direction column;
      align-items center;
      min-height 100vh;
      padding 20px;
    }

    .container {
      width 100%;
      max-width 1280px;
      background var(--card-bg);
      border-radius 24px;
      box-shadow var(--shadow);
      padding 40px;
      border 1px solid var(--border);
      flex 1;
    }

     Header & Nav 
    .header { display flex; justify-content space-between; align-items center; margin-bottom 30px; gap 15px; }
    .brand { display flex; align-items center; gap 15px; overflow hidden; }
    .logo-m {
      width 50px; height 50px;
      background linear-gradient(135deg, #fb923c 0%, #f97316 100%);
      border-radius 12px;
      display flex; align-items center; justify-content center;
      color white; font-size 30px; font-weight 900;
      box-shadow 0 4px 10px rgba(249, 115, 22, 0.4);
      flex-shrink 0;
    }
    .header-text h1 { margin 0; font-size 30px; font-weight 800; white-space nowrap; }
    .theme-btn { padding 10px 20px; border-radius 99px; border 1px solid var(--border); background var(--card-bg); color var(--text-main); cursor pointer; font-weight 600; font-size 16px; flex-shrink 0; }
    
    .nav-bar { display flex; gap 12px; margin-bottom 40px; padding-bottom 20px; border-bottom 2px solid var(--border); flex-wrap wrap; }
    .nav-btn { padding 12px 22px; border-radius 12px; text-decoration none; background var(--bg-color); color var(--text-sub); font-weight 600; border 1px solid var(--border); transition 0.3s; }
    .nav-btnhover { border-color var(--accent); color var(--accent); transform translateY(-2px); }
    .nav-btn.active { background var(--accent); color white; border-color var(--accent); box-shadow 0 4px 12px rgba(249, 115, 22, 0.3); }
    .nav-btn.guide { border-color #10b981; color #059669; }
    .nav-btn.guidehover { background #10b981; color white; }
    
    .nav-mobile { display none; margin-bottom 30px; }
    .nav-mobile select { width 100%; padding 15px; border-radius 12px; border 2px solid var(--accent); background var(--card-bg); color var(--text-main); font-size 17px; font-weight 700; cursor pointer; appearance none; background-image url(dataimagesvg+xml;charset=UTF-8,%3Csvg xmlns='httpwww.w3.org2000svg' viewBox='0 0 24 24' fill='none' stroke='%23f97316' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3Cpolyline%3E%3Csvg%3E); background-repeat no-repeat; background-position right 15px center; background-size 18px; }

     åŸºæœ¬æ¨£å¼ 
    .panel { border 1px solid var(--border); padding 25px; border-radius 18px; background rgba(0,0,0,0.01); margin-bottom 25px; }
    input, select { width 100%; padding 14px; border-radius 12px; border 2px solid var(--border); background var(--input-bg); color var(--text-main); font-size 17px; }
    inputfocus { outline none; border-color var(--accent); background var(--input-focus); }

     ç‰©å“è¼¸å…¥æ¡†æ¨£å¼å„ªåŒ– (å«åœ–ç‰‡) 
    .item-input-box { background var(--card-bg); padding 18px; border-radius 15px; border 1px solid var(--border); position relative; display flex; flex-direction column; align-items center; }
    
     ç‰©å“åœ–ç‰‡å®¹å™¨ 
    .item-img-wrapper {
        width 48px; height 48px; margin-bottom 8px;
        display flex; align-items center; justify-content center;
        border-radius 8px; background var(--bg-color); border 1px solid var(--border);
    }
    .item-img-wrapper img { max-width 100%; max-height 100%; object-fit contain; }
    
    .item-label { font-size 15px; font-weight 700; margin-bottom 10px; text-align center; min-height 24px; display flex; align-items center; justify-content center; }
    .live-stat { font-size 13px; color var(--accent); font-weight 600; margin-top 8px; display flex; justify-content space-between; width 100%; }
    .qty-group { display flex; gap 8px; width 100%; }
    .qty-group input { text-align center; font-weight bold; width 100%; }

     æ€ªç‰©é¸æ“‡èˆ‡åœ–ç‰‡ 
    .monster-select-wrapper { display flex; gap 15px; align-items center; margin-bottom 20px; }
    .monster-img-preview {
        width 60px; height 60px; flex-shrink 0;
        border-radius 12px; border 2px solid var(--accent);
        background var(--bg-color); display flex; align-items center; justify-content center; overflow hidden;
    }
    .monster-img-preview img { width 100%; height 100%; object-fit cover; }

    .btn-submit { width 100%; padding 20px; border none; border-radius 15px; background linear-gradient(135deg, #fb923c 0%, #f97316 100%); color white; font-size 22px; font-weight 800; cursor pointer; margin-top 20px; transition 0.3s; }
    .btn-submithover { transform scale(1.01); box-shadow 0 6px 20px rgba(249, 115, 22, 0.4); }
    .btn-submitdisabled { filter grayscale(1); cursor not-allowed; }

     Accordion 
    .accordion-group { background var(--card-bg); border 1px solid var(--border); border-radius 16px; margin-bottom 20px; overflow hidden; transition all 0.3s ease; }
    .accordion-header { padding 18px 25px; background rgba(0,0,0,0.02); cursor pointer; display flex; justify-content space-between; align-items center; user-select none; border-bottom 1px solid transparent; transition background 0.2s; }
    .accordion-headerhover { background rgba(0,0,0,0.04); }
    .accordion-group.open .accordion-header { border-bottom-color var(--border); }
    .accordion-title { font-size 18px; font-weight 700; color var(--accent); display flex; align-items center; gap 10px; }
    .accordion-titlebefore { content ; width 4px; height 18px; background var(--accent); border-radius 2px; }
    .accordion-icon { font-size 14px; color var(--text-sub); transition transform 0.3s ease; }
    .accordion-group.open .accordion-icon { transform rotate(180deg); }
    .accordion-content { display none; padding 20px; background var(--card-bg); }
    .accordion-group.open .accordion-content { display block; animation fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity 0; transform translateY(-5px); } to { opacity 1; transform translateY(0); } }

    .drop-grid { display grid; grid-template-columns repeat(auto-fill, minmax(240px, 1fr)); gap 15px; }
    footer { width 100%; max-width 1280px; margin-top 40px; padding 30px 0; border-top 1px solid var(--border); display flex; justify-content space-between; align-items center; flex-wrap wrap; gap 20px; }
    .footer-links { display flex; gap 25px; }
    .footer-links a { text-decoration none; color var(--text-sub); font-size 15px; font-weight 500; }
    .footer-links ahover { color var(--accent); }
    .copyright { font-size 15px; color var(--text-sub); }
    .hidden { display none; }

     Mobile 
    @media (max-width 768px) {
      body { padding 10px; }
      .container { padding 20px; border-radius 16px; }
      .header-text h1 { font-size 20px; }
      .header-text div { font-size 12px !important; }
      .logo-m { width 40px; height 40px; font-size 24px; }
      .theme-btn { padding 8px 15px; font-size 14px; }
      .nav-bar { display none; }
      .nav-mobile { display block; }
      .panel { padding 15px; }
      .footer-links { width 100%; justify-content center; gap 15px; }
      .copyright { width 100%; text-align center; font-size 13px; }
      .accordion-header { padding 15px; }
      .accordion-content { padding 15px; }
      .accordion-title { font-size 16px; }
       Mobile Grid 
      .drop-grid { grid-template-columns 1fr; }
      
      .item-input-box { flex-direction row; align-items center; gap 15px; padding 12px; }
      .item-img-wrapper { margin-bottom 0; width 40px; height 40px; flex-shrink 0; }
      .item-label { margin-bottom 0; text-align left; justify-content flex-start; flex 1; }
      .qty-group { width auto; gap 5px; }
      .qty-group input { width 50px; padding 8px; font-size 14px; }
      .live-stat { display none; }
    }
  style
head
body

div class=container
  div class=header
    div class=brand
      div class=logo-mMdiv
      div class=header-text
        h1Artale æ‰å¯¶çµ±è¨ˆç«™h1
        div style=colorvar(--text-sub); font-size 15px; font-weight 500;ç²¾æº–è¨ˆç®—æ“Šæ®ºæ•¸èˆ‡æ‰è½ç‡ (æ¸¬è©¦ç‰ˆ)div
      div
    div
    button class=theme-btn id=theme-toggleğŸŒ™ å¤œé–“æ¨¡å¼button
  div

  nav class=nav-bar
    a href=index.html class=nav-btn activeä¸€èˆ¬å›å ±a
    a href=stats.html class=nav-btnä¸€èˆ¬çµ±è¨ˆa
    a href=playerStats.html class=nav-btnå€‹äººçµ±è¨ˆa
    a href=boss.html class=nav-btnBOSSå›å ±a
    a href=stats2.html class=nav-btnBOSSçµ±è¨ˆa
    a href=playerBossStats.html class=nav-btnBOSSå€‹äººçµ±è¨ˆa
    a href=httpsforum.gamer.com.twC.phpbsn=79354&snA=8900&tnum=3&b target=_blank class=nav-btn guideğŸ“˜ ä½¿ç”¨èªªæ˜a
  nav

  div class=nav-mobile
    select onchange=if(this.value.includes('http')) { window.open(this.value, '_blank'); this.value='index.html'; } else { window.location.href=this.value; }
      option value=index.html selectedåŠŸèƒ½åˆ‡æ›ï¼šä¸€èˆ¬å›å ±option
      option value=stats.htmlä¸€èˆ¬çµ±è¨ˆoption
      option value=playerStats.htmlå€‹äººçµ±è¨ˆoption
      option value=boss.htmlBOSSå›å ±option
      option value=stats2.htmlBOSSçµ±è¨ˆoption
      option value=playerBossStats.htmlBOSSå€‹äººçµ±è¨ˆoption
      option value=httpsforum.gamer.com.twC.phpbsn=79354&snA=8900&tnum=3&bğŸ“˜ ä½¿ç”¨èªªæ˜ (å¤–éƒ¨é€£çµ)option
    select
  div

  form id=dropForm
    div class=panel
      div style=display grid; grid-template-columns repeat(auto-fit, minmax(300px, 1fr)); gap 30px;
        div
          label style=font-weight700; margin-bottom5px; displayblock;ç©å®¶è§’è‰² ID (åŒ…å« #12345)label
          input type=text id=player-id placeholder=ä¾‹å¦‚ï¼šRainYu#B1234 required
        div
        div style=display flex; align-items center; padding-top 25px;
          label style=display flex; align-items center; gap 12px; cursor pointer; margin 0;
            input type=checkbox id=dual-mode-toggle style=width 22px; height 22px; 
            span style=font-weight700;é–‹å•Ÿé›™æ€ªå›å ±æ¨¡å¼span
          label
        div
      div
    div

    div id=panels-wrapper
      div class=panel id=panel-1
        div class=section-title style=margin-top0; colorvar(--accent); font-size20px; font-weight700; margin-bottom15px; displayflex; align-itemscenter; gap10px;
          div style=width5px; height22px; backgroundvar(--accent); border-radius2px;div
          æ€ªç‰© 1ï¼šé¸æ“‡å°è±¡
        div
        
        div class=monster-select-wrapper
            div class=monster-img-preview
                img id=m1-img src= alt=Monster style=displaynone;
            div
            select id=monster-select-1 required style=width 100%;
              option value=æ­£åœ¨é€£ç·šä¼ºæœå™¨...option
            select
        div
        
        div id=content-1 class=hidden
          div style=margin-bottom 25px; padding 15px; background var(--bg-color); border-radius 12px; border 1px solid var(--border);
             div style=displayflex; justify-contentspace-between; margin-bottom10px; font-weightbold; colorvar(--text-sub);
                spanæ ¸å¿ƒæ•¸æ“šspan
                span id=m1-kills-displayæ¨ç®—æ“Šæ®ºæ•¸ï¼š0span
             div
             
             div class=item-input-box style=border1px solid var(--accent);
                div class=item-img-wrapper
                    img id=m1-tail-img src= alt=Icon style=displaynone;
                div
                div class=item-label id=label-tail-1 style=colorvar(--accent);ä¸»æ‰è½ç‰©div
                div class=qty-group
                  input type=number id=m1-c4-init placeholder=å§‹
                  input type=number id=m1-c4-final placeholder=çµ‚
                  input type=number id=m1-c4-delta readonly placeholder=0 style=backgroundvar(--bg-color)
                div
                div class=live-stat
                  span id=m1-tail-rate-texté è¨­æ‰è½ç‡ï¼š--span
                  span id=m1-kills-textæ“Šæ®ºæ•¸ï¼š0span
                div
             div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleğŸ“œ ç¨€æœ‰å·è»¸div
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m1-grid-scrollsdiv
            div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleğŸ’ ç¨€æœ‰å¤§çdiv
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m1-grid-jackpotsdiv
            div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleâš”ï¸ è£å‚™æ‰è½div
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m1-grid-equipdiv
            div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleğŸª¨ æ¯ç¤¦èˆ‡ç¤¦çŸ³div
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m1-grid-oresdiv
            div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleğŸ“¦ å…¶ä»–ç‰©å“div
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m1-grid-othersdiv
            div
          div
        div
      div

      div class=panel hidden id=panel-2
        div class=section-title style=margin-top0; colorvar(--accent); font-size20px; font-weight700; margin-bottom15px; displayflex; align-itemscenter; gap10px;
          div style=width5px; height22px; backgroundvar(--accent); border-radius2px;div
          æ€ªç‰© 2ï¼šé¸æ“‡å°è±¡
        div
        
        div class=monster-select-wrapper
            div class=monster-img-preview
                img id=m2-img src= alt=Monster style=displaynone;
            div
            select id=monster-select-2 style=width 100%;
              option value=è«‹é¸æ“‡æ€ªç‰©option
            select
        div
        
        div id=content-2 class=hidden
           div style=margin-bottom 25px; padding 15px; background var(--bg-color); border-radius 12px; border 1px solid var(--border);
             div style=displayflex; justify-contentspace-between; margin-bottom10px; font-weightbold; colorvar(--text-sub);
                spanæ ¸å¿ƒæ•¸æ“šspan
                span id=m2-kills-displayæ¨ç®—æ“Šæ®ºæ•¸ï¼š0span
             div
             
             div class=item-input-box style=border1px solid var(--accent);
                div class=item-img-wrapper
                    img id=m2-tail-img src= alt=Icon style=displaynone;
                div
                div class=item-label id=label-tail-2 style=colorvar(--accent);ä¸»æ‰è½ç‰©div
                div class=qty-group
                  input type=number id=m2-c4-init placeholder=å§‹
                  input type=number id=m2-c4-final placeholder=çµ‚
                  input type=number id=m2-c4-delta readonly placeholder=0 style=backgroundvar(--bg-color)
                div
                div class=live-stat
                  span id=m2-tail-rate-texté è¨­æ‰è½ç‡ï¼š--span
                  span id=m2-kills-textæ“Šæ®ºæ•¸ï¼š0span
                div
             div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleğŸ“œ ç¨€æœ‰å·è»¸div
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m2-grid-scrollsdiv
            div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleğŸ’ ç¨€æœ‰å¤§çdiv
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m2-grid-jackpotsdiv
            div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleâš”ï¸ è£å‚™æ‰è½div
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m2-grid-equipdiv
            div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleğŸª¨ æ¯ç¤¦èˆ‡ç¤¦çŸ³div
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m2-grid-oresdiv
            div
          div

          div class=accordion-group open onclick=toggleAccordion(this)
            div class=accordion-header
              div class=accordion-titleğŸ“¦ å…¶ä»–ç‰©å“div
              div class=accordion-iconâ–¼div
            div
            div class=accordion-content
              div class=drop-grid id=m2-grid-othersdiv
            div
          div
        div
      div
    div

    button type=submit class=btn-submit id=submit-btné€å‡ºçµ±è¨ˆè³‡æ–™button
  form

  footer
    div class=footer-links
      a href=about.htmlé—œæ–¼æœ¬ç«™a
      a href=terms.htmlä½¿ç”¨æ¢æ¬¾a
      a href=privacy-policy.htmléš±ç§æ¬Šæ”¿ç­–a
      a href=contact.htmlè¯çµ¡æˆ‘å€‘a
    div

    div style=display flex; flex-direction column; align-items center; gap 10px; margin 25px 0;
      div style=font-size 15px; color var(--text-sub); font-weight 600; display flex; align-items center; gap 6px;
        â˜• è´ŠåŠ©è¾›è‹¦çš„ç«™é•·ä¸€æ¯å’–å•¡
      div
      
      a href=httpswww.buymeacoffee.comyuyujay target=_blank style=display inline-block; transition transform 0.2s; onmouseover=this.style.transform='scale(1.05)' onmouseout=this.style.transform='scale(1)'
        img src=httpscdn.buymeacoffee.combuttonsv2default-orange.png alt=Buy Me A Coffee style=height 40px !important; width 150px !important; display block;
      a
    div

    div class=copyright
      &copy; 2025 Artale Drop Statistics. All rights reserved.
    div
  footer
div

script
   âœ… 1. æ­£ç¢ºè¨­å®š Cloudflare ç’°å¢ƒä¸‹çš„ API ç¶²å€ (åŒç¶²åŸŸ)
  const API_URL = 'api'; 

  let monsterConfigs = { 1 null, 2 null };
  let estimatedKills = { 1 0, 2 0 };
  const COOLDOWN_MS = 3  60  1000;  3åˆ†é˜

  document.addEventListener('DOMContentLoaded', () = {
    initTheme();
    loadMonsterList();
    setupEventListeners();
  });

  function toggleAccordion(element) {
    if (event.target.tagName === 'INPUT') return;
    element.classList.toggle('open');
  }

  function initTheme() {
    const btn = document.getElementById('theme-toggle');
    const isNight = localStorage.getItem('theme') === 'dark';
    if (isNight) { document.body.classList.add('night-mode'); btn.innerText = 'â˜€ï¸ æ—¥é–“æ¨¡å¼'; }
    btn.addEventListener('click', () = {
      const active = document.body.classList.toggle('night-mode');
      localStorage.setItem('theme', active  'dark'  'light');
      btn.innerText = active  'â˜€ï¸ æ—¥é–“æ¨¡å¼'  'ğŸŒ™ å¤œé–“æ¨¡å¼';
    });
  }

  async function loadMonsterList() {
    try {
       âœ… 2. åŠ ä¸Š api=1 åƒæ•¸
      const resp = await fetch(`${API_URL}api=1&action=getMonsterList`);
      const res = await resp.json();
      if (res.ok) {
        const options = 'option value=è«‹é¸æ“‡æ€ªç‰©...option' + res.data.map(m = `option value=${m}${m}option`).join('');
        document.getElementById('monster-select-1').innerHTML = options;
        document.getElementById('monster-select-2').innerHTML = options;
      }
    } catch (e) { console.error(e); }
  }

  async function handleMonsterChange(slot, monsterName) {
    if (!monsterName) return;
    const container = document.getElementById(`content-${slot}`);
    if (container) container.classList.remove('hidden');

    try {
       âœ… 3. åŠ ä¸Š api=1 åƒæ•¸
      const resp = await fetch(`${API_URL}api=1&action=getMonsterConfig&monster=${encodeURIComponent(monsterName)}`);
      const res = await resp.json();
      if (res.ok) {
        monsterConfigs[slot] = res.data;
        renderFields(slot, res.data);
        updateKillCalculation(slot);
        
         æ›´æ–°æ€ªç‰©åœ–ç‰‡ (A2 æ¬„ä½)
        const monsterImgEl = document.getElementById(`m${slot}-img`);
        if (res.data.monsterImage) {
            monsterImgEl.src = res.data.monsterImage;
            monsterImgEl.style.display = 'block';
        } else {
            monsterImgEl.style.display = 'none';
        }
      }
    } catch (e) { console.error(e); }
  }

  function renderFields(slot, config) {
    const p = `m${slot}`;
    
     ä¸»æ‰è½ç‰© (Tail)
    const tailLabel = document.getElementById(`label-tail-${slot}`);
    if(tailLabel) tailLabel.innerText = config.tail;
    
     ä¸»æ‰è½ç‰©åœ–ç‰‡
    const tailImg = document.getElementById(`${p}-tail-img`);
    if(config.tailImage) {
        tailImg.src = config.tailImage;
        tailImg.style.display = 'block';
    } else {
        tailImg.style.display = 'none';
    }

    const ratePercent = (config.tailRate  100).toFixed(1) + '%';
    const rateText = document.getElementById(`${p}-tail-rate-text`);
    if(rateText) rateText.innerText = `é è¨­æ‰è½ç‡ï¼š${ratePercent}`;

     å»ºç«‹è¼¸å…¥æ¡†çš„ Helper Function (æ”¯æ´åœ–ç‰‡)
    const createInput = (name, imgUrl, colIndex) = {
      if (!name  name.trim() === ) return ;
      
      let imgHtml = ;
      if (imgUrl && imgUrl.trim() !== ) {
          imgHtml = `div class=item-img-wrapperimg src=${imgUrl} onerror=this.style.display='none'div`;
      } else {
           ä½”ä½ï¼Œä¿æŒæ’ç‰ˆä¸€è‡´ (å¯é¸)
          imgHtml = `div class=item-img-wrapper style=opacity0;div`;
      }

      return `
        div class=item-input-box
          ${imgHtml}
          div class=item-label${name}div
          div class=qty-group
            input type=number id=${p}-c${colIndex}-init placeholder=å§‹
            input type=number id=${p}-c${colIndex}-final placeholder=çµ‚
            input type=number id=${p}-c${colIndex}-delta readonly placeholder=0
          div
          div class=live-stat id=stat-${p}-c${colIndex}æ‰è½ç‡ï¼š--div
        div`;
    };

    const noData = 'div style=colorvar(--text-sub); font-size14px; padding10px 0;ç„¡æ­¤é¡ç‰©å“div';
    const safeSetHTML = (id, html) = { const el = document.getElementById(id); if (el) el.innerHTML = html; };

     å–å¾—åœ–ç‰‡é™£åˆ—
    const sImgs = config.scrollImages  [];
    const jImgs = config.jackpotImages  [];
    const eImgs = config.equipImages  [];
    const oImgs = config.oreImages  [];
    const otImgs = config.otherImages  [];

     æ¸²æŸ“å„å€å¡Š
    const scrollsHtml = config.scrolls.map((n, i) = createInput(n, sImgs[i], 5 + i)).join('');
    safeSetHTML(`${p}-grid-scrolls`, scrollsHtml  noData);

    const jackpotsHtml = config.jackpots.map((n, i) = createInput(n, jImgs[i], 10 + i)).join('');
    safeSetHTML(`${p}-grid-jackpots`, jackpotsHtml  noData);
    
    const equipHtml = config.equips.map((n, i) = createInput(n, eImgs[i], 13 + i)).join('');
    safeSetHTML(`${p}-grid-equip`, equipHtml  noData);
    
    const oresHtml = config.ores.map((n, i) = createInput(n, oImgs[i], 36 + i)).join('');
    safeSetHTML(`${p}-grid-ores`, oresHtml  noData);

    const othersHtml = config.others.map((n, i) = createInput(n, otImgs[i], 43 + i)).join('');
    safeSetHTML(`${p}-grid-others`, othersHtml  noData);
  }

  function setupEventListeners() {
    document.getElementById('monster-select-1').addEventListener('change', (e) = handleMonsterChange(1, e.target.value));
    document.getElementById('monster-select-2').addEventListener('change', (e) = handleMonsterChange(2, e.target.value));

    document.getElementById('dual-mode-toggle').addEventListener('change', (e) = {
      document.getElementById('panel-2').classList.toggle('hidden', !e.target.checked);
    });

    document.addEventListener('input', (e) = {
      if (e.target.id.includes('-init')  e.target.id.includes('-final')) {
        const parts = e.target.id.split('-');
        const slot = parts[0] === 'm1'  1  2;
        const colId = parts[1];

        const baseId = `${parts[0]}-${parts[1]}`;
        const initVal = parseInt(document.getElementById(baseId + '-init').value)  0;
        const finalVal = parseInt(document.getElementById(baseId + '-final').value)  0;
        const delta = Math.max(0, finalVal - initVal);
        
        const deltaEl = document.getElementById(baseId + '-delta');
        if (deltaEl) deltaEl.value = delta;

        if (colId === 'c4') {
          updateKillCalculation(slot);
        } else {
          updateItemRate(slot, colId, delta);
        }
      }
    });

    document.getElementById('dropForm').addEventListener('submit', handleSubmit);
  }

  function updateKillCalculation(slot) {
    const config = monsterConfigs[slot];
    if (!config) return;

    const deltaEl = document.getElementById(`m${slot}-c4-delta`);
    const delta = deltaEl  (parseInt(deltaEl.value)  0)  0;
    
    const kills = Math.floor(delta  (config.tailRate  0.01));
    estimatedKills[slot] = kills;

    const kText = document.getElementById(`m${slot}-kills-text`);
    if(kText) kText.innerText = `æ“Šæ®ºæ•¸ï¼š${kills}`;
    
    const kDisplay = document.getElementById(`m${slot}-kills-display`);
    if(kDisplay) kDisplay.innerText = `æ¨ç®—æ“Šæ®ºæ•¸ï¼š${kills}`;

    for (let i = 5; i = 47; i++) {
      const dEl = document.getElementById(`m${slot}-c${i}-delta`);
      if (dEl) updateItemRate(slot, `c${i}`, parseInt(dEl.value)  0);
    }
  }

  function updateItemRate(slot, colId, delta) {
    const kills = estimatedKills[slot];
    const statEl = document.getElementById(`stat-m${slot}-${colId}`);
    if (!statEl) return;

    if (kills = 0  delta = 0) {
      statEl.innerText = 'æ‰è½ç‡ï¼š--';
      return;
    }

    const rate = delta  kills;
    const invRate = Math.round(kills  delta);
    statEl.innerText = `æ‰è½ç‡ï¼š${(rate  100).toFixed(3)}% (1${invRate})`;
  }

  async function handleSubmit(e) {
    e.preventDefault();

    const lastSubmit = localStorage.getItem('lastSubmitTime');
    const now = Date.now();
    if (lastSubmit && now - lastSubmit  COOLDOWN_MS) {
      const remaining = Math.ceil((COOLDOWN_MS - (now - lastSubmit))  1000);
      alert(`è«‹é–“éš”3åˆ†é˜å¾Œå†å¡«å…¥ (å‰©é¤˜ ${remaining} ç§’)`);
      return;
    }

    let hasJackpot = false;
    const checkJackpot = (slot) = {
      for(let i=10; i=12; i++) {
        const val = parseInt(document.getElementById(`m${slot}-c${i}-delta`).value)  0;
        if(val  0) hasJackpot = true;
      }
    };
    checkJackpot(1);
    if(document.getElementById('dual-mode-toggle').checked) checkJackpot(2);

    const btn = document.getElementById('submit-btn');
    btn.disabled = true;
    btn.innerText = 'æ­£åœ¨ä¸Šå‚³æ•¸æ“š...';

    try {
      let isSuspicious = false;
      const res1 = await submitSingleMonster(1);
      if(res1.status === 'SUSPECT') isSuspicious = true;

      if (document.getElementById('dual-mode-toggle').checked) {
        const res2 = await submitSingleMonster(2);
        if(res2.status === 'SUSPECT') isSuspicious = true;
      }

      localStorage.setItem('lastSubmitTime', Date.now());

      let msg = 'å›å ±æˆåŠŸï¼';
      if(hasJackpot) {
        msg += 'nnã€æé†’ã€‘åµæ¸¬åˆ°å¤§çè³‡æ–™ï¼Œè«‹è¯çµ¡ç®¡ç†å“¡æä¾›æˆªåœ–è³‡è¨Šï¼Œæœ¬è³‡æ–™æ‰æœƒç™»éŒ„ç³»çµ±ã€‚';
      }
      if(isSuspicious) {
        msg += 'nnã€æ³¨æ„ã€‘é€å‡ºè³‡æ–™å«æœ‰å¯ç–‘è³‡æ–™ï¼Œå°‡äº¤ç”±ç®¡ç†å“¡è¤‡æŸ¥ã€‚';
      }

      alert(msg);
      location.reload();

    } catch (err) {
      alert(err.message);
      btn.disabled = false;
      btn.innerText = 'é‡æ–°é€å‡º';
    }
  }

  async function submitSingleMonster(slot) {
    const monster = document.getElementById(`monster-select-${slot}`).value;
    if (!monster) return { status 'OK' }; 

    const player = document.getElementById('player-id').value;
    const kills = estimatedKills[slot];

    if (kills  100) throw new Error(`[${monster}] æ¨ç®—æ“Šæ®ºæ•¸ä¸è¶³ 100ï¼Œè«‹ç´¯ç©æ›´å¤šæ•¸æ“š`);

    const payload = { action 'submitDrop', player, monster, kills, type 'normal' };
    for (let i = 4; i = 47; i++) {
      const el = document.getElementById(`m${slot}-c${i}-delta`);
      if (el) payload[`c${i}`] = parseInt(el.value)  0;
    }

     âœ… 4. POST ä¹Ÿè£œä¸Š api=1ï¼Œç¢ºä¿å¾Œç«¯æ­£ç¢ºåˆ‡æ›æ¨¡å¼
    const resp = await fetch(API_URL + 'api=1', {
      method 'POST',
      headers { 'Content-Type' 'applicationjson' },
      body JSON.stringify(payload)
    });
    const res = await resp.json();
    
    if (!res.ok) throw new Error(res.error);
    return res.data; 
  }
script

body
html